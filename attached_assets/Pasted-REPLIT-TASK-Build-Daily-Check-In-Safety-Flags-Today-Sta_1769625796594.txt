REPLIT TASK: Build Daily Check-In + Safety Flags + Today State API (V1)

GOAL
Implement a working backend + minimal UI flow that:
1) captures a daily check-in (energy, pain, confidence, side effects, red-flag symptoms)
2) evaluates safety status (GREEN / YELLOW / RED)
3) returns a “Today State” payload the Today Card can use, including:
   - readiness score
   - session intensity modifier
   - safety message (green/yellow/red)
   - explain-why text (short, calm)

SCOPE
- Backend: DB tables, validation, endpoints, safety evaluation function, explain-why generator
- Frontend: a basic Daily Check-In screen + submit + display Today State result (no fancy styling required)
- No need to generate the full exercise session yet (stub it as “session_level”: VERY_LOW/LOW/MEDIUM)

DATA MODEL (Postgres)
Table: daily_checkins
- id (uuid pk)
- user_id (uuid fk users)
- date (date, unique per user)
- energy (int 1-10) NOT NULL
- pain (int 1-10) NOT NULL
- confidence (int 1-10) NOT NULL
- side_effects (jsonb) default '[]'
   Example array of strings: ["nausea","neuropathy","sleep_poor","dizziness_mild"]
- red_flags (jsonb) default '[]'
   Example array of strings: ["chest_pain","fever","severe_breathlessness","new_severe_swelling"]
- notes (text) nullable
- created_at (timestamptz)
- updated_at (timestamptz)

Table: today_states (optional, can compute on read instead)
- id (uuid pk)
- user_id
- date
- safety_status (text enum: GREEN|YELLOW|RED)
- readiness_score (int 0-100)
- intensity_modifier (text enum: DOWN2|DOWN1|SAME|UP1)  // likely mostly DOWN
- session_level (text enum: VERY_LOW|LOW|MEDIUM)
- explain_why (text)
- safety_message_title (text)
- safety_message_body (text)

ENDPOINTS
POST /api/checkins
Body:
{
  "date": "2026-01-28",
  "energy": 4,
  "pain": 3,
  "confidence": 5,
  "side_effects": ["nausea","sleep_poor"],
  "red_flags": [],
  "notes": ""
}
Returns:
{
  "todayState": { ...see Today State payload below... }
}

GET /api/today-state?date=YYYY-MM-DD
Returns todayState for that date (compute from checkin if not stored).

TODAY STATE PAYLOAD (shape)
{
  "date": "2026-01-28",
  "safetyStatus": "YELLOW",
  "readinessScore": 48,
  "sessionLevel": "VERY_LOW",
  "intensityModifier": "DOWN1",
  "explainWhy": "We’re keeping things gentle today because your energy is lower and you’ve reported nausea. The goal is to support your body, not push it.",
  "safetyMessage": {
    "title": "Let’s take this gently today.",
    "body": "Reduce intensity and monitor how you feel. If symptoms continue or you’re unsure, check with your clinician."
  }
}

SAFETY EVALUATION RULES (deterministic)
1) If red_flags array contains ANY of:
   ["chest_pain","fever","severe_breathlessness","fainting","new_sudden_swelling","signs_of_infection"]
   => safetyStatus = RED
   => sessionLevel = VERY_LOW
   => intensityModifier = DOWN2
   => safety message: pause exercise + contact medical team

2) Else if side_effects contains ANY “yellow flag” items:
   ["dizziness_mild","new_swelling","neuropathy_flare","unusual_fatigue_spike","persistent_joint_pain"]
   OR energy <= 3
   OR pain >= 7
   => safetyStatus = YELLOW
   => sessionLevel = VERY_LOW or LOW (choose VERY_LOW if energy<=3 or pain>=7 else LOW)
   => intensityModifier = DOWN1
   => safety message: proceed gently + monitor + “If unsure, check with your clinician.”

3) Else => GREEN
   => sessionLevel = LOW or MEDIUM
      - if energy >= 7 and pain <= 3 and confidence >= 6 => MEDIUM
      - else => LOW
   => intensityModifier = SAME

READINESS SCORE (simple & explainable)
Compute 0–100:
- energy contributes 40% (energy/10*40)
- confidence contributes 40% (confidence/10*40)
- pain reduces 20% ( (10-pain)/10*20 )
Round to int.
Clamp 0–100.

EXPLAIN-WHY GENERATOR
Return 1–2 sentences in calm “Rock of Certainty” tone.
Rules:
- If RED: “Please pause exercise for now…”
- If YELLOW due to low energy: mention low energy
- If YELLOW due to pain: mention discomfort
- If YELLOW due to side effects: mention the top 1–2 side effects
- If GREEN: “Comfortable effort… build consistency…”
No hype words. No guilt.

FRONTEND MINIMUM
Route: /checkin
- inputs: date (default today), energy slider, pain slider, confidence slider
- multi-select: side_effects
- multi-select: red_flags (separate section with warning styling)
- submit -> show Today State result card

ACCEPTANCE CRITERIA
- One checkin per user per date (upsert if resubmitted)
- Validation: 1–10 on sliders
- Today State always returned after POST
- Safety status matches rules above
- Explain-why text always non-empty and appropriate to status
- No AI used; purely deterministic logic
